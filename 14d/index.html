<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BACK TO THE FUTURE - Fase 1</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    body {
      background-image: url('iPhone-wallpaper-back-to-the-future.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom center;
      background-attachment: fixed;
    }

    /* Bot√≥n DeLorean */
    .delorean-btn {
      position: relative;
      display: inline-block;
      margin-top: 20px;
      z-index: 9999;
      
      padding: 18px 40px;
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 800;
      text-transform: uppercase;
      color: #000;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
      border: 3px solid #ff6600;
      border-radius: 8px;
      box-shadow: 
        0 0 20px rgba(255,102,0,0.8),
        0 0 40px rgba(255,215,0,0.6),
        inset 0 2px 4px rgba(255,255,255,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.3);
      
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      
      animation: buttonPulse 2s ease-in-out infinite;
    }

    .delorean-btn:hover {
      transform: scale(1.1);
      box-shadow: 
        0 0 30px rgba(255,102,0,1),
        0 0 60px rgba(255,215,0,0.9),
        inset 0 2px 4px rgba(255,255,255,0.6),
        inset 0 -2px 4px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, #ffed4e 0%, #ffd700 50%, #ffed4e 100%);
    }

    .delorean-btn:active {
      transform: scale(0.95);
      box-shadow: 
        0 0 15px rgba(255,102,0,0.6),
        inset 0 2px 8px rgba(0,0,0,0.4);
    }

    @keyframes buttonPulse {
      0%, 100% { 
        box-shadow: 
          0 0 20px rgba(255,102,0,0.8),
          0 0 40px rgba(255,215,0,0.6),
          inset 0 2px 4px rgba(255,255,255,0.4);
      }
      50% { 
        box-shadow: 
          0 0 30px rgba(255,102,0,1),
          0 0 60px rgba(255,215,0,0.9),
          inset 0 2px 4px rgba(255,255,255,0.6);
      }
    }

    @media (max-width: 768px) {
      .delorean-btn {
        font-size: 16px;
        padding: 14px 28px;
      }
    }

    /* Bot√≥n de inicio */
    #startBtn {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
      padding: 25px 60px;
      font-family: 'Orbitron', monospace;
      font-size: 32px;
      font-weight: 900;
      text-transform: uppercase;
      color: #000;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
      border: 4px solid #ff6600;
      border-radius: 12px;
      box-shadow: 
        0 0 30px rgba(255,102,0,1),
        0 0 60px rgba(255,215,0,0.8),
        inset 0 3px 6px rgba(255,255,255,0.5),
        inset 0 -3px 6px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: startPulse 1.5s ease-in-out infinite;
    }

    #startBtn:hover {
      transform: translate(-50%, -50%) scale(1.15);
      box-shadow: 
        0 0 40px rgba(255,102,0,1),
        0 0 80px rgba(255,215,0,1),
        inset 0 3px 6px rgba(255,255,255,0.7);
      background: linear-gradient(135deg, #ffed4e 0%, #ffd700 50%, #ffed4e 100%);
    }

    @keyframes startPulse {
      0%, 100% { 
        box-shadow: 
          0 0 30px rgba(255,102,0,1),
          0 0 60px rgba(255,215,0,0.8),
          inset 0 3px 6px rgba(255,255,255,0.5);
      }
      50% { 
        box-shadow: 
          0 0 45px rgba(255,102,0,1),
          0 0 90px rgba(255,215,0,1),
          inset 0 3px 6px rgba(255,255,255,0.7);
      }
    }

    /* Ocultar contenido inicialmente */
    #mainContent {
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease-in;
    }

    #mainContent.show {
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 768px) {
      #startBtn {
        font-size: 24px;
        padding: 20px 45px;
      }
    }

    /* Contador de tiempo */
    #countdown {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10001;
      font-family: 'Orbitron', monospace;
      font-size: 120px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 
        0 0 20px rgba(255,215,0,1),
        0 0 40px rgba(255,102,0,1),
        0 0 60px rgba(255,102,0,0.8);
      animation: countPulse 1s ease-in-out infinite;
    }

    #countdown.show {
      display: block;
    }

    @keyframes countPulse {
      0%, 100% { 
        transform: translate(-50%, -50%) scale(1);
        text-shadow: 
          0 0 20px rgba(255,215,0,1),
          0 0 40px rgba(255,102,0,1),
          0 0 60px rgba(255,102,0,0.8);
      }
      50% { 
        transform: translate(-50%, -50%) scale(1.1);
        text-shadow: 
          0 0 30px rgba(255,215,0,1),
          0 0 60px rgba(255,102,0,1),
          0 0 90px rgba(255,102,0,1);
      }
    }

    @media (max-width: 768px) {
      #countdown {
        font-size: 80px;
      }
    }

    /* Links de navegaci√≥n inferior */
    #phaseLinks {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      display: flex;
      gap: 15px;
      padding: 10px 20px;
      background: rgba(11, 18, 33, 0.8);
      border-radius: 20px;
      border: 2px solid rgba(255, 102, 0, 0.5);
      box-shadow: 0 0 20px rgba(255, 102, 0, 0.3);
    }

    .phase-link {
      font-family: 'Orbitron', monospace;
      font-size: 14px;
      font-weight: 700;
      color: #ffd700;
      text-decoration: none;
      padding: 8px 15px;
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    .phase-link:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: rgba(255, 215, 0, 0.6);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      #phaseLinks {
        gap: 8px;
        padding: 8px 12px;
      }
      .phase-link {
        font-size: 11px;
        padding: 6px 10px;
      }
    }

    /* Modal de video */
    #videoModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 99999;
      justify-content: center;
      align-items: center;
    }

    #videoModal.show {
      display: flex;
    }

    #videoContainer {
      position: relative;
      width: 90%;
      max-width: 800px;
      aspect-ratio: 16/9;
    }

    #videoContainer iframe,
    #videoContainer video {
      width: 100%;
      height: 100%;
      border: 4px solid #ff6600;
      border-radius: 8px;
      box-shadow: 0 0 30px rgba(255,102,0,0.8);
    }

    /* Modal close button */
    .video-close {
      position: absolute;
      top: -18px;
      right: -18px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #ff6600;
      color: #fff;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #ffd700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
      z-index: 100001;
    }

      /* Resplandor retro-futurista ‚Äî versi√≥n m√°s intensa */
    .btf-glow {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at center,
        rgba(255,120,0,0.55) 0%,
        rgba(255,0,80,0.50) 30%,
        rgba(0,200,255,0.45) 60%,
        rgba(0,0,0,0) 80%
      );
      mix-blend-mode: screen;
      animation: glowPulse 4s ease-in-out infinite;
      opacity: 0.9;
      filter: blur(2px);
    }
    @keyframes glowPulse {
      0%,100% { opacity: 0.75; }
      50% { opacity: 1; }
    }

    /* Rejilla neon "synthwave" ‚Äî m√°s brillante y visible */
    .btf-grid {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 50vh;
      pointer-events: none;
      background-image:
        linear-gradient(0deg, rgba(0,255,255,0.6) 2px, transparent 2px),
        linear-gradient(90deg, rgba(255,0,200,0.6) 2px, transparent 2px);
      background-size: 45px 45px;
      transform: perspective(800px) rotateX(70deg);
      opacity: 0.9;
      mix-blend-mode: screen;
      animation: gridGlow 6s linear infinite alternate;
      filter: blur(0.4px);
    }
    @keyframes gridGlow {
      0% { opacity: 0.6; }
      100% { opacity: 1; }
    }

    /* Chispas m√°s visibles */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(circle,
        rgba(0,180,255,0.45) 0%,
        rgba(0,0,0,0) 60%
      );
      mix-blend-mode: screen;
      animation: sparks 2.8s infinite ease-in-out;
      opacity: 0.8;
    }
    @keyframes sparks {
      0%,100% { opacity: 0.6; filter: blur(8px); }
      50% { opacity: 1; filter: blur(14px); }
    }
    @keyframes glowPulse {
      0%,100% { opacity: 0.35; }
      50% { opacity: 0.6; }
    }

    /* Rejilla neon "synthwave" */
    .btf-grid {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 45vh;
      pointer-events: none;
      background-image:
        linear-gradient(0deg, rgba(255,255,255,0.14) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.14) 1px, transparent 1px);
      background-size: 55px 55px;
      transform: perspective(900px) rotateX(65deg);
      opacity: 0.45;
      mix-blend-mode: screen;
      animation: gridGlow 10s linear infinite alternate;
      filter: blur(0.6px);
    }
    @keyframes gridGlow {
      0% { opacity: 0.3; }
      100% { opacity: 0.6; }
    }

    /* Peque√±as chispas azules simulando energ√≠a del Delorean */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, rgba(0,200,255,0.17) 0%, rgba(0,0,0,0) 65%);
      mix-blend-mode: screen;
      animation: sparks 4s infinite ease-in-out;
    }
    @keyframes sparks {
      0%,100% { opacity: 0.25; filter: blur(10px); }
      50% { opacity: 0.55; filter: blur(14px); }
    }

    /* Rayo animado intenso */
    .btf-lightning {
      position: fixed;
      top: 0;
      left: 50%;
      width: 4px;
      height: 100%;
      background: linear-gradient(
        to bottom,
        rgba(0,200,255,0) 0%,
        rgba(0,200,255,0) 20%,
        rgba(0,200,255,1) 45%,
        rgba(255,255,255,1) 50%,
        rgba(0,200,255,1) 55%,
        rgba(0,200,255,0) 80%,
        rgba(0,200,255,0) 100%
      );
      transform: translateX(-50%);
      filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      animation: lightningFlash 6s infinite;
      mix-blend-mode: screen;
    }

    @keyframes lightningFlash {
      0%, 92%, 100% { opacity: 0; }
      93% { opacity: 1; height: 80%; }
      94% { opacity: 0.6; height: 100%; }
      95% { opacity: 1; height: 60%; }
    }
  /* Ondas de choque circulares */
    .btf-shockwave {
      position: fixed;
      top: 50%; left: 50%;
      width: 20px; height: 20px;
      border-radius: 50%;
      border: 4px solid rgba(0,200,255,0.8);
      transform: translate(-50%, -50%);
      animation: shock 3s infinite;
      mix-blend-mode: screen;
      pointer-events: none;
      opacity: 0.9;
    }
    @keyframes shock {
      0% { width: 20px; height: 20px; opacity: 1; }
      100% { width: 900px; height: 900px; opacity: 0; }
    }

    /* Fuego temporal en el suelo */
    .btf-fire {
      position: fixed;
      bottom: 0; left: 50%;
      width: 80%; height: 120px;
      transform: translateX(-50%);
      background: radial-gradient(circle,
        rgba(255,120,0,0.8) 0%,
        rgba(255,30,0,0.7) 40%,
        rgba(255,255,0,0.4) 60%,
        rgba(0,0,0,0) 100%
      );
      mix-blend-mode: screen;
      filter: blur(12px);
      animation: firePulse 2.5s infinite ease-in-out;
      pointer-events: none;
    }
    @keyframes firePulse {
      0%,100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* Estelas del DeLorean */
    .btf-trails {
      position: fixed;
      bottom: 0; left: 50%;
      width: 70%; height: 3px;
      transform: translateX(-50%);
      background: linear-gradient(90deg,
        rgba(255,80,0,1), rgba(255,200,0,1), rgba(255,80,0,1)
      );
      filter: blur(4px);
      animation: trailsFlash 1.2s infinite;
      mix-blend-mode: screen;
      pointer-events: none;
    }
    @keyframes trailsFlash {
      0%,100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    /* Part√≠culas energ√©ticas */
    .btf-particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(circle,
        rgba(0,200,255,0.5) 2px,
        rgba(0,0,0,0) 3px
      );
      background-size: 120px 120px;
      animation: particlesMove 8s linear infinite;
      mix-blend-mode: screen;
      opacity: 0.6;
    }
    @keyframes particlesMove {
      0% { background-position: 0 0; }
      100% { background-position: 200px 400px; }
    }

    /* Distorsi√≥n temporal */
    .btf-warp {
      position: fixed;
      top: 50%; left: 50%;
      width: 300px; height: 300px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background: radial-gradient(circle,
        rgba(255,255,255,0.9) 0%,
        rgba(0,200,255,0.5) 40%,
        rgba(0,0,0,0) 80%
      );
      filter: blur(22px);
      opacity: 0.5;
      animation: warpPulse 3.5s infinite ease-in-out;
      mix-blend-mode: screen;
      pointer-events: none;
    }
    @keyframes warpPulse {
      0%,100% { transform: translate(-50%, -50%) scale(1); opacity: 0.4; }
      50% { transform: translate(-50%, -50%) scale(1.35); opacity: 0.9; }
    }

@media (max-width: 768px) {
      /* MODO ULTRA-EFECTISTA PARA M√ìVIL */

      /* Fondo m√°s oscuro para resaltar efectos */
      body {
        background-size: contain;
        background-position: center bottom;
        background-attachment: scroll;
        filter: brightness(0.75) contrast(1.2);
      }

      /* Rejilla enorme, m√°s brillante y animada m√°s r√°pido */
      .btf-grid {
        height: 55vh;
        background-size: 28px 28px;
        opacity: 0.9 !important;
        transform: perspective(500px) rotateX(72deg);
        animation: gridGlow 4s linear infinite alternate !important;
      }

      /* Rayo m√°s grueso y con vibraci√≥n */
      .btf-lightning {
        width: 6px;
        filter: blur(3px);
        animation: lightningFlash 3s infinite;
      }

      /* Shockwave gigante y m√°s r√°pida */
      .btf-shockwave {
        width: 20px; height: 20px;
        border-width: 6px;
        animation: shockMobile 2s infinite;
      }
      @keyframes shockMobile {
        0% { width: 20px; height: 20px; opacity: 1; }
        100% { width: 850px; height: 850px; opacity: 0; }
      }

      /* Fuego muy luminoso y pulsante */
      .btf-fire {
        height: 120px;
        filter: blur(14px);
        animation: firePulse 1.8s infinite;
        opacity: 1;
      }

      /* Estelas m√°s gruesas y brillantes */
      .btf-trails {
        height: 4px;
        filter: blur(5px);
        animation: trailsFlash 0.8s infinite;
      }

      /* Part√≠culas m√°s densas y movi√©ndose m√°s deprisa */
      .btf-particles {
        background-size: 60px 60px;
        animation: particlesMove 4s linear infinite;
        opacity: 0.9;
      }

      /* Distorsi√≥n temporal m√°s grande, m√°s luz */
      .btf-warp {
        width: 280px;
        height: 280px;
        opacity: 0.7;
        filter: blur(26px);
        animation: warpPulse 2.2s infinite;
      }

      /* Glow m√°s fuerte */
      .btf-glow {
        opacity: 1;
        filter: blur(6px);
        animation: glowPulse 2s alternate infinite;
      }
    }

    @media (max-width: 768px) {
      body {
        background-size: contain;
        background-position: center bottom;
        background-attachment: scroll;
      }
      .btf-grid {
        height: 35vh;
        background-size: 35px 35px;
        transform: perspective(600px) rotateX(60deg);
      }
      .btf-lightning {
        width: 3px;
        filter: blur(1.5px);
      }
      .btf-shockwave {
        width: 10px; height: 10px;
      }
      @keyframes shock {
        0% { width: 10px; height: 10px; opacity: 1; }
        100% { width: 500px; height: 500px; opacity: 0; }
      }
      .btf-fire {
        height: 80px;
        filter: blur(10px);
      }
      .btf-trails {
        width: 80%; height: 2px;
      }
      .btf-warp {
        width: 200px; height: 200px;
        filter: blur(16px);
      }
      .btf-particles {
        background-size: 80px 80px;
      }
    }
</style>
</head>
<body>
  <!-- Bot√≥n de inicio -->
  <button id="startBtn">COMEN√áAR!</button>

  <!-- Contador -->
  <div id="countdown"></div>

  <!-- Links de fases -->
  <div id="phaseLinks">
    <a href="#" class="phase-link" data-phase="1" data-key="ZmFzZTE=">Fase_1</a>
    <a href="#" class="phase-link" data-phase="2" data-key="cXVhbg==">Fase_2</a>
    <a href="#" class="phase-link" data-phase="3" data-key="bGE=">Fase_3</a>
    <a href="#" class="phase-link" data-phase="4" data-key="bXVudGFueWE=">Fase_4</a>
    <a href="#" class="phase-link" data-phase="5" data-key="Y2F1">Fase_5</a>
  </div>

  <!-- Contenido principal oculto inicialmente -->
  <div id="mainContent">
  <!-- Efecto: resplandor azul rojizo tipo "time travel" -->
  <div class="btf-glow"></div>

  <!-- Efecto: rejilla futurista tipo suelo de los 80 -->
  <div class="btf-grid"></div>
  <!-- Rayo animado estilo torre del reloj -->
  <div class="btf-lightning"></div>
  <div class="btf-shockwave"></div>
  <div class="btf-fire"></div>
  <div class="btf-trails"></div>
  <div class="btf-particles"></div>
  <div class="btf-warp"></div>
  <!-- Audio Back to the Future con fade-out -->
  <audio id="themeAudio" src="theme.mp3" preload="auto"></audio>
  <script>
    const audio = document.getElementById('themeAudio');
    audio.volume = 0;

    // --- FADE IN ---
    function fadeIn() {
      let v = 0;
      const steps = 40;
      const interval = 2500 / steps;
      const fade = setInterval(() => {
        v += 1 / steps;
        if (v >= 1) {
          audio.volume = 1;
          clearInterval(fade);
          setTimeout(fadeOut, 1500); // deja sonar antes del fade out
        } else {
          audio.volume = v;
        }
      }, interval);
    }

    // --- FADE OUT ---
    function fadeOut() {
      let v = 1;
      const steps = 50;
      const interval = 7000 / steps;
      const fade = setInterval(() => {
        v -= 1 / steps;
        if (v <= 0) {
          audio.volume = 0;
          clearInterval(fade);
          audio.pause();
        } else {
          audio.volume = v;
        }
      }, interval);
    }
  </script>
  
  <div id="intro-text" style="position: absolute; top: 10%; width: 100%; text-align: center; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 1.2rem; line-height: 1.6; text-shadow: 0 0 8px #f80, 0 0 12px #f40; padding: 0 20px;">
    <p>Benvinguts a l'aventura de Back To The Future.<br>
    Avui sereu vosaltres els protagonistes.<br>
    Enlloc de "Hill Valley" viatjareu per "Hill Badaloney".
    <p>El primer! Munteu al Delorian! <br>
    perqu√® heu de fer-lo arribar a <strong>180km/h.</strong><br>
    Llavors ...Saltareu en el temps!!!</p>

    <p> </p>
    <p>Premeu els botons alternativament fins a 180km/h<br>
    feu-ho molt molt de pressa o no ho aconseguireu!</p>
    </p>
    <p>Si arribeu a 180km/h .. Quelcom passar√†!</p>
    <p><strong>Sort!!</strong></p>
    <br><br>
    
    <!-- Bot√≥n DeLorean -->
    <a href="#" id="deloreanBtn" class="delorean-btn">
      üöó Saltar al DeLorean üí®
    </a>
  </div>
  </div> <!-- Cierre de mainContent -->

  <!-- Modal de video -->
  <div id="videoModal" aria-hidden="true">
    <div id="videoContainer">
      <!-- Close button for the modal -->
      <button class="video-close" id="videoClose" aria-label="Cerrar v√≠deo">‚úï</button>

      <!-- Local video (expects video.mp4 next to index.html) -->
      <video id="localVideo" src="video.mp4" controls playsinline preload="metadata" style="background:#000; display:block;" tabindex="0">
        Tu navegador no soporta el elemento <code>video</code>.
      </video>
    </div>
  </div>

  <script>
    // Manejar el bot√≥n de inicio
    document.getElementById('startBtn').addEventListener('click', function() {
      // Ocultar el bot√≥n
      this.style.display = 'none';
      
      // Mostrar el contenido principal
      document.getElementById('mainContent').classList.add('show');
      
      // Iniciar el audio
      audio.play().then(() => {
        fadeIn();
      }).catch(err => console.log('Error al reproducir:', err));
    });


    // Manejar el bot√≥n del DeLorean: abrir modal y reproducir local video
    document.getElementById('deloreanBtn').addEventListener('click', function(e) {
      e.preventDefault();

      const modal = document.getElementById('videoModal');
      const video = document.getElementById('localVideo');

      // Mostrar modal y reproducir
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      try {
        video.currentTime = 0;
        video.play().catch(err => console.log('Reproducci√≥n bloqueada o no permitida:', err));
      } catch (err) {
        console.log('Error al reproducir el v√≠deo:', err);
      }

      // Importante: NO iniciamos la cuenta atr√°s aqu√≠. El temporizador
      // se activa S√ìLO cuando el usuario cierra el modal o cuando el
      // video termina.

      // Guard para evitar m√∫ltiples ejecuciones de la secuencia final
      let finishRequested = false;

      // referencia al elemento del contador
      const countdownEl = document.getElementById('countdown');

      // Inicia la cuenta atr√°s de 5s que redirige al finalizar
      const startFinishCountdown = () => {
        if (finishRequested) return; // ya iniciado
        finishRequested = true;

        countdownEl.classList.add('show');
        let timeLeft = 5;
        countdownEl.textContent = timeLeft;

        const interval = setInterval(() => {
          timeLeft--;
          countdownEl.textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(interval);
            try { video.pause(); } catch (e) {}
            modal.classList.remove('show');
            modal.setAttribute('aria-hidden', 'true');
            countdownEl.classList.remove('show');
            window.location.href = '180kmh/2_botones.html';
          }
        }, 1000);
      };

      // Cerrar modal desde el bot√≥n
      const closeBtn = document.getElementById('videoClose');
      const closeModal = () => {
        // Al cerrar manualmente, ocultamos el modal y arrancamos la cuenta atr√°s
        try { video.pause(); } catch (e) {}
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        startFinishCountdown();
      };

      if (closeBtn) closeBtn.onclick = closeModal;

      // Cerrar al hacer clic fuera del contenedor
      modal.addEventListener('click', function(ev) {
        if (ev.target === modal) closeModal();
      });

      // Cerrar con Escape
      document.addEventListener('keydown', function escHandler(ev) {
        if (ev.key === 'Escape') {
          closeModal();
          document.removeEventListener('keydown', escHandler);
        }
      });

      // Si el video termina, ocultar modal y arrancar la cuenta atr√°s de 5s
      video.addEventListener('ended', function() {
        try { video.pause(); } catch (e) {}
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        startFinishCountdown();
      });
    });

    // Manejar los links de fases
    // Destinos codificados (base64). Mantengo la estructura codificada.
    // Reemplac√© la entrada de fase 3 por la URL absoluta codificada en base64
    // https://jaumet-007.github.io/BTTF/14d/faaase3.html
    // Destinos codificados (base64). La entrada de Fase_3 apunta ahora a
    // https://jaumet-007.github.io/BTTF/14d/doc/faaase3.html (en base64)
    const _0x3f9d = ['aW5kZXguaHRtbA==', 'c2FuZG1hbi9mZmFzZTIuaHRtbA==', 'aHR0cHM6Ly9qYXVtZXQtMDA3LmdpdGh1Yi5pby9CVFRGLzE0ZC9kb2MvZmFhYXNlMy5odG1s', 'bG92ZS9mYXNzc3NlNC5odG1s', 'ZmFzZWVlZWU1Lmh0bWw='];
    
    document.querySelectorAll('.phase-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const phase = this.dataset.phase;
        const encodedKey = this.dataset.key;
        const userPassword = prompt('Introdueix la contrasenya:');
        
        if (userPassword && btoa(userPassword.toLowerCase()) === encodedKey) {
          window.location.href = atob(_0x3f9d[phase - 1]);
        } else if (userPassword) {
          alert('Contrasenya incorrecta!');
        }
      });
    });
  </script>
</body>
</html>
