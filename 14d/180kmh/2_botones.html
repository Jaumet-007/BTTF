<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Turbo Salt</title>
<style>
  :root{
    --bg:#0b1221;
    --panel:#0f2036;
    --accent:#ffd166;
    --accent2:#06d6a0;
    --danger:#ef476f;
    --muted:#9fb0c8;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;overflow:hidden;}
  body{
    background-image: url('iPhone-wallpaper-back-to-the-future.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center center;
    background-attachment: fixed;
    color:#e6f0fb;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:8px;
    padding:8px;
    box-sizing:border-box;
    overflow-y:auto;
    overflow-x:hidden;
    max-height:100vh;
  }

  /* Destello pantalla */
  #flash {
    position: fixed;
    top:0;left:0;width:100%;height:100%;
    background:white;
    opacity:0;
    pointer-events:none;
    transition:opacity 0.25s;
  }

  /* Shake */
  .shake {
    animation: shakeAnim 0.4s linear;
  }
  @keyframes shakeAnim {
    0% { transform: translate(0,0); }
    20% { transform: translate(-8px,2px); }
    40% { transform: translate(6px,-6px); }
    60% { transform: translate(-6px,4px); }
    80% { transform: translate(6px,0px); }
    100% { transform: translate(0,0); }
  }

  /* Confeti */
  #confetti-container {
    pointer-events:none;
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    overflow:hidden;
    z-index:99999;
  }
  .confetti {
    position:absolute;
    width:10px;height:10px;
    background: hsl(var(--h), 90%, 60%);
    animation: fall 1.5s linear forwards;
  }
  @keyframes fall {
    0% { transform: translateY(-20px) rotate(0deg); }
    100% { transform: translateY(120vh) rotate(360deg); }
  }

  .topbar{width:100%;max-width:500px;display:flex;align-items:center;justify-content:space-between;gap:8px;position:relative;z-index:10;margin-top:3rem}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(2,6,23,0.6);width:100%;position:relative;z-index:10}
  h1{margin:0;font-size:16px;color:var(--accent)}
  .stats{display:flex;gap:12px;align-items:center}
  #speedDisplay{font-size:24px;font-weight:700;color:#21a1ff}
  .sub{font-size:11px;color:var(--muted)}

  /* Back to the Future Effects */
  .btf-glow {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: radial-gradient(circle at center,
      rgba(255,120,0,0.55) 0%,
      rgba(255,0,80,0.50) 30%,
      rgba(0,200,255,0.45) 60%,
      rgba(0,0,0,0) 80%
    );
    mix-blend-mode: screen;
    animation: glowPulse 4s ease-in-out infinite;
    opacity: 0.9;
    filter: blur(2px);
    z-index: 1;
  }
  @keyframes glowPulse {
    0%,100% { opacity: 0.75; }
    50% { opacity: 1; }
  }

  .btf-grid {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50vh;
    pointer-events: none;
    background-image:
      linear-gradient(0deg, rgba(0,255,255,0.6) 2px, transparent 2px),
      linear-gradient(90deg, rgba(255,0,200,0.6) 2px, transparent 2px);
    background-size: 45px 45px;
    transform: perspective(800px) rotateX(70deg);
    opacity: 0.9;
    mix-blend-mode: screen;
    animation: gridGlow 6s linear infinite alternate;
    filter: blur(0.4px);
    z-index: 1;
  }
  @keyframes gridGlow {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }

  .btf-lightning {
    position: fixed;
    top: 0;
    left: 50%;
    width: 4px;
    height: 100%;
    background: linear-gradient(
      to bottom,
      rgba(0,200,255,0) 0%,
      rgba(0,200,255,0) 20%,
      rgba(0,200,255,1) 45%,
      rgba(255,255,255,1) 50%,
      rgba(0,200,255,1) 55%,
      rgba(0,200,255,0) 80%,
      rgba(0,200,255,0) 100%
    );
    transform: translateX(-50%);
    filter: blur(2px);
    opacity: 0;
    pointer-events: none;
    animation: lightningFlash 6s infinite;
    mix-blend-mode: screen;
    z-index: 1;
  }
  @keyframes lightningFlash {
    0%, 92%, 100% { opacity: 0; }
    93% { opacity: 1; height: 80%; }
    94% { opacity: 0.6; height: 100%; }
    95% { opacity: 1; height: 60%; }
  }

  .btf-shockwave {
    position: fixed;
    top: 50%; left: 50%;
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 4px solid rgba(0,200,255,0.8);
    transform: translate(-50%, -50%);
    animation: shock 3s infinite;
    mix-blend-mode: screen;
    pointer-events: none;
    opacity: 0.9;
    z-index: 1;
  }
  @keyframes shock {
    0% { width: 20px; height: 20px; opacity: 1; }
    100% { width: 900px; height: 900px; opacity: 0; }
  }

  .btf-fire {
    position: fixed;
    bottom: 0; left: 50%;
    width: 80%; height: 120px;
    transform: translateX(-50%);
    background: radial-gradient(circle,
      rgba(255,120,0,0.8) 0%,
      rgba(255,30,0,0.7) 40%,
      rgba(255,255,0,0.4) 60%,
      rgba(0,0,0,0) 100%
    );
    mix-blend-mode: screen;
    filter: blur(12px);
    animation: firePulse 2.5s infinite ease-in-out;
    pointer-events: none;
    z-index: 1;
  }
  @keyframes firePulse {
    0%,100% { opacity: 0.7; }
    50% { opacity: 1; }
  }

  .btf-trails {
    position: fixed;
    bottom: 0; left: 50%;
    width: 70%; height: 3px;
    transform: translateX(-50%);
    background: linear-gradient(90deg,
      rgba(255,80,0,1), rgba(255,200,0,1), rgba(255,80,0,1)
    );
    filter: blur(4px);
    animation: trailsFlash 1.2s infinite;
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 1;
  }
  @keyframes trailsFlash {
    0%,100% { opacity: 0.2; }
    50% { opacity: 1; }
  }

  .btf-particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background-image: radial-gradient(circle,
      rgba(0,200,255,0.5) 2px,
      rgba(0,0,0,0) 3px
    );
    background-size: 120px 120px;
    animation: particlesMove 8s linear infinite;
    mix-blend-mode: screen;
    opacity: 0.6;
    z-index: 1;
  }
  @keyframes particlesMove {
    0% { background-position: 0 0; }
    100% { background-position: 200px 400px; }
  }

  .btf-warp {
    position: fixed;
    top: 50%; left: 50%;
    width: 300px; height: 300px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: radial-gradient(circle,
      rgba(255,255,255,0.9) 0%,
      rgba(0,200,255,0.5) 40%,
      rgba(0,0,0,0) 80%
    );
    filter: blur(22px);
    opacity: 0.5;
    animation: warpPulse 3.5s infinite ease-in-out;
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 1;
  }
  @keyframes warpPulse {
    0%,100% { transform: translate(-50%, -50%) scale(1); opacity: 0.4; }
    50% { transform: translate(-50%, -50%) scale(1.35); opacity: 0.9; }
  }

  @media (max-width: 768px) {
    body {
      background-size: contain;
      background-position: center bottom;
      background-attachment: scroll;
      filter: brightness(0.75) contrast(1.2);
    }
    .btf-grid {
      height: 55vh;
      background-size: 28px 28px;
      opacity: 0.9 !important;
      transform: perspective(500px) rotateX(72deg);
      animation: gridGlow 4s linear infinite alternate !important;
    }
    .btf-lightning {
      width: 6px;
      filter: blur(3px);
      animation: lightningFlash 3s infinite;
    }
    .btf-shockwave {
      width: 20px; height: 20px;
      border-width: 6px;
      animation: shockMobile 2s infinite;
    }
    @keyframes shockMobile {
      0% { width: 20px; height: 20px; opacity: 1; }
      100% { width: 850px; height: 850px; opacity: 0; }
    }
    .btf-fire {
      height: 120px;
      filter: blur(14px);
      animation: firePulse 1.8s infinite;
      opacity: 1;
    }
    .btf-trails {
      height: 4px;
      filter: blur(5px);
      animation: trailsFlash 0.8s infinite;
    }
    .btf-particles {
      background-size: 60px 60px;
      animation: particlesMove 4s linear infinite;
      opacity: 0.9;
    }
    .btf-warp {
      width: 280px;
      height: 280px;
      opacity: 0.7;
      filter: blur(26px);
      animation: warpPulse 2.2s infinite;
    }
    .btf-glow {
      opacity: 1;
      filter: blur(6px);
      animation: glowPulse 2s alternate infinite;
    }
  }

  .meter-wrap{width:100%;max-width:500px;position:relative;z-index:10}
  .meter{position:relative;height:40px;background:#11243a;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
  .meter-fill{position:absolute;left:0;top:0;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#ffd9a8);box-shadow:inset 0 0 20px rgba(0,0,0,0.5)}
  .meter-ticks{position:absolute;left:0;top:0;height:100%;width:100%;display:flex;justify-content:space-between;align-items:center;padding:0 6px;pointer-events:none}
  .tick{font-size:10px;color:rgba(255,255,255,0.12)}
  .target{position:absolute;top:0;height:100%;width:3px;background:rgba(6,214,160,0.85);left:90%;transform:translateX(-50%);box-shadow:0 0 8px rgba(6,214,160,0.15)}
  .controls{display:flex;width:100%;max-width:500px;gap:8px;position:relative;z-index:10}
  .btn{
    flex:1;
    height:100px;
    border-radius:14px;
    background:linear-gradient(180deg,#0f2a45,#072039);
    display:flex;align-items:center;justify-content:center;
    font-size:20px;font-weight:800;color:white;
    user-select:none;touch-action:manipulation;
    box-shadow:0 8px rgba(2,6,23,0.6);
  }
  .btn:active{transform:translateY(2px);box-shadow:0 4px rgba(2,6,23,0.6)}
  .info-row{display:flex;gap:8px;align-items:center;justify-content:space-between;width:100%;max-width:500px;position:relative;z-index:10}
  .mini{background:#0a1624;padding:6px 8px;border-radius:10px;font-size:11px;color:var(--muted);position:relative;z-index:10}
  /* Phase links (botonera de fases) */
  #phaseLinks{
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    z-index: 10000; display:flex; gap:12px; padding:8px 14px;
    background: rgba(11,18,33,0.8); border-radius:16px; border:2px solid rgba(255,102,0,0.35);
  }

  .phase-link{ font-family:'Orbitron', monospace; font-weight:700; color:#ffd700; padding:6px 12px; background: rgba(255,215,0,0.06); border-radius:8px; text-decoration:none; }
</style>
</head>
<body>
<!-- Back to the Future Effects -->
<div class="btf-glow"></div>
<div class="btf-grid"></div>
<div class="btf-lightning"></div>
<div class="btf-shockwave"></div>
<div class="btf-fire"></div>
<div class="btf-trails"></div>
<div class="btf-particles"></div>
<div class="btf-warp"></div>

<div id="flash"></div>
<div id="confetti-container"></div>

<div class="topbar" style="max-width:500px">
    <div class="card" style="display:flex;flex-direction:column">
    <h1>Back to the Future — Salto en el tiempo</h1>
    <div class="sub">Alterna <-- → -->  hasta los <strong>140 km/h</strong> y activarás el <strong>salto temporal</strong> del DeLorean</div>
  </div>
  <div style="width:140px;flex-shrink:0">
    <div class="card center">
      <div class="sub">Intentos</div>
      <div id="attemptsDisplay" class="big">0</div>
    </div>
  </div>
</div>

<div class="meter-wrap card">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
    <div>
      <div class="sub">Velocidad</div>
      <div id="speedDisplay">0.0 km/h</div>
    </div>
    <div style="text-align:right">
      <div class="sub">TPS</div>
      <div id="tpsDisplay" class="big">0.0</div>
    </div>
  </div>
  <div class="meter" id="meter">
    <div class="meter-fill" id="meterFill"></div>
    <div class="target"></div>
    <div class="meter-ticks">
      <div class="tick">0</div>
      <div class="tick">45</div>
      <div class="tick">90</div>
      <div class="tick">135</div>
      <div class="tick">180</div>
    </div>
  </div>
</div>

<div class="info-row">
  <div class="mini">Lado: <span id="lastSide">Ninguno</span></div>
  <div class="mini">Progresión: <span id="progression">x1.00</span></div>
  <div class="mini">Estado: <span id="state">Listo</span></div>
</div>

<div class="controls">
  <div id="btnLeft" class="btn"><--</div>
  <div id="btnRight" class="btn">--></div>
</div>

<div id="phaseLinks">
  <a href="#" class="phase-link" data-phase="1" data-key="">Fase_1</a>
  <a href="#" class="phase-link" data-phase="2" data-key="MTQwS01I">Fase_2</a>
  <a href="#" class="phase-link" data-phase="3" data-key="U0FORE1BTjE5NTU=">Fase_3</a>
  <a href="#" class="phase-link" data-phase="4" data-key="RkVSTUFY">Fase_4</a>
  <a href="#" class="phase-link" data-phase="5" data-key="TE9WRTE5NTU=">Fase_5</a>
</div>

<script>
/* -------------------------------------------
   PARÁMETROS AJUSTADOS (más fácil)
------------------------------------------- */
const MAX_SPEED = 180;
const BASE_BOOST = 2.05;
const BASE_DECAY = 4.75;
const HIGH_SPEED_SCALE = 1.30;
const LOW_SPEED_SCALE = 0.90;
const MID_SPEED_SCALE = 0.80;
const ATTEMPT_BOOST_PER_FAIL = 0.02;
const MAX_PROGRESSION = 1.05;
const TPS_WINDOW = 1600;
const WIN_SPEED = 140;

/* ESTADO */
let currentSpeed = 0;
let lastSide = null;
let tapsTimestamps = [];
let attemptCount = 0;
let sessionFails = 0;
let progressionMultiplier = 1.0;

/* ELEMENTOS */
const speedDisplay = document.getElementById('speedDisplay');
const tpsDisplay = document.getElementById('tpsDisplay');
const meterFill = document.getElementById('meterFill');
const lastSideEl = document.getElementById('lastSide');
const attemptsDisplay = document.getElementById('attemptsDisplay');
const progressionEl = document.getElementById('progression');
const stateEl = document.getElementById('state');
const btnLeft = document.getElementById('btnLeft');
const btnRight = document.getElementById('btnRight');
const flash = document.getElementById('flash');
const confettiContainer = document.getElementById('confetti-container');

/* UTILIDADES */
function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }
function beep(freq=440, duration=0.1, vol=0.15){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='square';
    o.frequency.value=freq;
    g.gain.value=vol;
    o.connect(g);g.connect(ctx.destination);
    o.start();
    setTimeout(()=>{o.stop();ctx.close();}, duration*1000);
  }catch(e){}
}

/* EFECTO DESTELLO */
function doFlash(){
  flash.style.opacity = 1;
  setTimeout(()=>flash.style.opacity=0,200);
}

/* CONFETI */
function spawnConfetti(){
  for(let i=0;i<40;i++){
    const c=document.createElement('div');
    c.className='confetti';
    c.style.setProperty('--h', Math.floor(Math.random()*360));
    c.style.left=Math.random()*100+'%';
    confettiContainer.appendChild(c);
    setTimeout(()=>c.remove(),1500);
  }
}

/* TAP LOGIC */
function registerTap(side){
  const t=Date.now();
  tapsTimestamps.push(t);
  tapsTimestamps = tapsTimestamps.filter(x=>x>=t-TPS_WINDOW);

  const tps = tapsTimestamps.length / (TPS_WINDOW/1000);
  tpsDisplay.textContent = tps.toFixed(2);

  let valid = (lastSide === null || lastSide !== side);
  lastSide = side;
  lastSideEl.textContent = side==='L'?'<--':'-->';

  if(!valid){
    currentSpeed=Math.max(0,currentSpeed-1);
    stateEl.textContent='No alternaste';
    vibrate(20);
    beep(200,0.08,0.05);
    return;
  }

  const speedRatio = currentSpeed/MAX_SPEED;
  let scale = LOW_SPEED_SCALE;
  if(speedRatio>0.7) scale=HIGH_SPEED_SCALE;
  else if(speedRatio>0.4) scale=MID_SPEED_SCALE;

  const tpsFactor = Math.min(1 + (tps/8), 1.8);
  const speedPenalty = 1 - Math.pow(speedRatio,1.4);
  const prog = progressionMultiplier;

  const boost = BASE_BOOST * scale * tpsFactor * speedPenalty * prog;
  const actualBoost = Math.max(0.4, boost);
  currentSpeed = Math.min(MAX_SPEED, currentSpeed + actualBoost);

  stateEl.textContent='+'+actualBoost.toFixed(1)+' km/h';
  vibrate(15);
  beep(500+currentSpeed,0.04,0.08);
}

/* LOOP */
let lastTick=performance.now();
function loop(ts){
  const dt=(ts-lastTick)/1000;
  lastTick=ts;

  currentSpeed=Math.max(0,currentSpeed-BASE_DECAY*dt);

  speedDisplay.textContent=currentSpeed.toFixed(1)+' km/h';
  meterFill.style.width=(currentSpeed/MAX_SPEED*100)+'%';

  if(currentSpeed >= WIN_SPEED){
    victory();
    return;
  }

  requestAnimationFrame(loop);
}

/* VICTORIA */

// Decrypt Adventure Lab password
function decryptLabWord() {
  const encrypted = 'MTQwa21o';
  return atob(encrypted);
}

function victory(){
  stateEl.textContent='¡SALTO TEMPORAL ACTIVADO!';

  // Reproducir música victory.mp3
  const audio = new Audio('victory.mp3');
  audio.volume = 1.0;
  audio.play().catch(()=>{});

  // Vibración + efectos
  vibrate([150,70,150]);
  document.body.classList.add('shake');
  doFlash();
  spawnConfetti();

  
  (function showVictoryMessage(){
    const msg = document.createElement('div');
    msg.id = 'victoryMessage';
    msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(2,6,23,0.92);color:#fff;padding:18px 22px;border-radius:12px;font-size:18px;font-weight:800;z-index:100000;text-align:center;box-shadow:0 12px 40px rgba(0,0,0,0.6);backdrop-filter: blur(6px);';
    msg.innerHTML = '¡SÍ! HAS VIAJADO a <span style="color:#ffd166">"HILL BADALONEY"</span> de <strong>1955</strong><br>palabra para el lab: ' + decryptLabWord();
    document.body.appendChild(msg);
    // Animación de entrada (permanece visible indefinidamente)
    msg.style.opacity = '0';
    msg.style.transition = 'opacity 240ms ease, transform 240ms ease';
    msg.style.transform = 'translate(-50%,-48%) scale(0.98)';
    requestAnimationFrame(()=>{ msg.style.opacity='1'; msg.style.transform='translate(-50%,-50%) scale(1)'; });
  })();

  // Efecto de huellas de fuego del Delorean
  const fire1=document.createElement('div');
  const fire2=document.createElement('div');
  fire1.style.cssText='position:fixed;bottom:45%;left:20%;width:60%;height:5px;background:linear-gradient(90deg,#ffea00,#ff7b00,#ff0000);box-shadow:0 0 25px #ff6a00;z-index:9999;opacity:1;transition:opacity 1.1s';
  fire2.style.cssText='position:fixed;bottom:40%;left:20%;width:60%;height:5px;background:linear-gradient(90deg,#ffea00,#ff7b00,#ff0000);box-shadow:0 0 25px #ff6a00;z-index:9999;opacity:1;transition:opacity 1.1s';

  document.body.appendChild(fire1);
  document.body.appendChild(fire2);

  setTimeout(()=>{
    fire1.style.opacity=0;
    fire2.style.opacity=0;
  },300);

  setTimeout(()=>{
    fire1.remove();
    fire2.remove();
  },1400);

  attemptCount++;
  attemptsDisplay.textContent=attemptCount;

  setTimeout(()=>{
    document.body.classList.remove('shake');
    currentSpeed=0;
    lastSide=null;
    tapsTimestamps=[];
    stateEl.textContent='Listo para otro salto temporal';
    requestAnimationFrame(loop);
  },1200);
}

btnLeft.addEventListener('touchstart',()=>registerTap('L'));
btnLeft.addEventListener('mousedown',()=>registerTap('L'));
btnRight.addEventListener('touchstart',()=>registerTap('R'));
btnRight.addEventListener('mousedown',()=>registerTap('R'));

requestAnimationFrame(loop);

/* THEME AUDIO WITH FADE */
const themeAudio = new Audio('theme.mp3');
themeAudio.volume = 0;
themeAudio.preload = 'auto';

function startThemeAudio() {
  themeAudio.play().then(() => {
    fadeInTheme();
  }).catch(err => console.log('Error playing theme:', err));
}

document.addEventListener('click', startThemeAudio, { once: true });
document.addEventListener('touchstart', startThemeAudio, { once: true });

function fadeInTheme() {
  let v = 0;
  const steps = 40;
  const interval = 2500 / steps;
  const fade = setInterval(() => {
    v += 1 / steps;
    if (v >= 1) {
      themeAudio.volume = 1;
      clearInterval(fade);
      setTimeout(fadeOutTheme, 1500);
    } else {
      themeAudio.volume = v;
    }
  }, interval);
}

function fadeOutTheme() {
  let v = 1;
  const steps = 50;
  const interval = 7000 / steps;
  const fade = setInterval(() => {
    v -= 1 / steps;
    if (v <= 0) {
      themeAudio.volume = 0;
      clearInterval(fade);
      themeAudio.pause();
    } else {
      themeAudio.volume = v;
    }
  }, interval);
}
</script>
<script>
  // Phase links keep the base64-password pattern from original files
  document.querySelectorAll('.phase-link').forEach(link => {
    link.addEventListener('click', function(e){
      e.preventDefault();
      const phase = this.dataset.phase;
      const encodedKey = this.dataset.key;
      
      // Fase 1 sin contraseña
      if (phase === '1') {
        window.location.href = atob(['aW5kZXguaHRtbA==','c2FuZG1hbi9mZmFzZTIuaHRtbA==','ZmFhYXNlMy5odG1s','bG92ZS9mYXNzc3NlNC5odG1s','ZmFzZWVlZWU1Lmh0bWw='][phase-1]);
        return;
      }
      
      const userPassword = prompt('Introduce la contraseña:');
      if (userPassword && btoa(userPassword.toUpperCase()) === encodedKey) {
        // By default, redirect to decoded path
        window.location.href = atob(['aW5kZXguaHRtbA==','c2FuZG1hbi9mZmFzZTIuaHRtbA==','ZmFhYXNlMy5odG1s','bG92ZS9mYXNzc3NlNC5odG1s','ZmFzZWVlZWU1Lmh0bWw='][phase-1]);
      } else if (userPassword) {
        alert('¡Contraseña incorrecta!');
      }
    });
  });
</script>
</body>
</html>
